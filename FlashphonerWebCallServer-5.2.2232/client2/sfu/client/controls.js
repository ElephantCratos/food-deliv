const createControls=function(e){let t=function(){};const o={entrance:{url:document.getElementById("url"),roomName:document.getElementById("roomName"),roomPin:document.getElementById("roomPin"),nickName:document.getElementById("nickName"),enter:document.getElementById("startButton")},addVideoTrack:{source:document.getElementById("addVideoTrackSource"),width:document.getElementById("addVideoTrackWidth"),height:document.getElementById("addVideoTrackHeight"),codec:document.getElementById("addVideoTrackCodec")},addAudioTrack:{source:document.getElementById("addAudioTrackSource"),channels:document.getElementById("addAudioTrackChannels")},addVideoEncoding:{rid:document.getElementById("addVideoTrackEncodingRid"),active:document.getElementById("addVideoTrackEncodingActive"),maxBitrate:document.getElementById("addVideoTrackEncodingMaxBitrate"),resolutionScale:document.getElementById("addVideoTrackEncodingResolutionScale"),scalabilityMode:document.getElementById("addVideoTrackScalabilityMode")},tables:{video:$("#videoTracksTable").DataTable({sDom:"t",columns:[{className:"details-control",orderable:!1,data:null,defaultContent:""},{data:"source"},{data:"width"},{data:"height"},{data:"codec"},{data:"action"}]}),audio:$("#audioTracksTable").DataTable({sDom:"t",columns:[{data:"source"},{data:"channels"},{data:"action"}]}),encodings:$("#videoTrackEncodingsTable").DataTable({sDom:"t",columns:[{data:"rid"},{data:"active"},{data:"maxBitrate"},{data:"resolutionScale"},{data:"scalabilityMode"},{data:"action"}]})}};o.entrance.url.value=e.room.url,o.entrance.roomName.value=e.room.name,o.entrance.roomPin.value=e.room.pin,o.entrance.nickName.value=e.room.nickName;const a=async function(e){const a=await getMedia([e]);let n='<button id="'+a.id+'-button" class="btn btn-primary">Delete</button>';const d=o.tables.audio.row.add({source:e.source,channels:e.channels,action:n,stream:a}).node();o.tables.audio.draw(),$("#"+a.id+"-button").on("click",(function(){console.log("terminate audio stream "+a.id);let e=a.getAudioTracks()[0];e.stop(),e.dispatchEvent(new Event("ended"))})).prop("disabled",!0),a.getTracks()[0].onended=function(){o.tables.audio.row(d).remove().draw()},t({stream:a,encodings:e.encodings,source:e.source,type:e.type})},n=async function(e){const a=await getMedia([e]);let n='<button id="'+a.id+'-button" class="btn btn-primary">Delete</button>';const d=o.tables.video.row.add({source:e.source,width:e.width,height:e.height,codec:e.codec,action:n,stream:a,encodings:e.encodings}).node();o.tables.video.draw(),$("#"+a.id+"-button").on("click",(function(){console.log("terminate video stream "+a.id);let e=a.getVideoTracks()[0];e.stop(),e.dispatchEvent(new Event("ended"))})).prop("disabled",!0),a.getTracks()[0].addEventListener("ended",(function(){o.tables.video.row(d).remove().draw()})),t({stream:a,encodings:e.encodings,source:e.source})};return{muteInput:function(){!function(e){for(const[t,o]of Object.entries(e))o.disabled=!0}(o.entrance)},roomConfig:function(){let t={url:o.entrance.url.value,roomName:o.entrance.roomName.value,pin:o.entrance.roomPin.value,nickname:o.entrance.nickName.value};return void 0!==e.room.failedProbesThreshold&&(t.failedProbesThreshold=e.room.failedProbesThreshold),void 0!==e.room.pingInterval&&(t.pingInterval=e.room.pingInterval),t},displayTables:async function(){$("#videoTracksTableBody").on("click","td.details-control",(function(){let e=$(this).closest("tr"),t=o.tables.video.row(e);t.child.isShown()?(t.child.hide(),e.removeClass("shown")):(t.child(function(e){if(!e.encodings)return;let t='<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';return e.encodings.forEach((function(e){t+="<tr>";for(const[o,a]of Object.entries(e))t+="<td>"+o+"</td><td>"+a+"</td>";t+="</tr>"})),t+="</table>",t}(t.data())).show(),e.addClass("shown"))}));for(const t of e.media.audio.tracks)await a(t);for(const t of e.media.video.tracks)await n(t);document.getElementById("addVideoTrack").addEventListener("click",(function(e){let t=[];o.tables.encodings.rows().every((function(){let e=this.data();t.push({rid:e.rid,active:e.active,maxBitrate:e.maxBitrate,scaleResolutionDownBy:e.resolutionScale,scalabilityMode:e.scalabilityMode})}));let a={source:o.addVideoTrack.source.value,width:o.addVideoTrack.width.value,height:o.addVideoTrack.height.value,codec:o.addVideoTrack.codec.value,encodings:t};n(a)})),$("#videoTrackEncodingsTable").on("click",".remove",(function(){o.tables.encodings.row($(this).parents("tr")).remove().draw()})),document.getElementById("addVideoTrackEncoding").addEventListener("click",(function(){o.tables.encodings.row.add({rid:o.addVideoEncoding.rid.value,active:o.addVideoEncoding.active.value,maxBitrate:o.addVideoEncoding.maxBitrate.value,resolutionScale:o.addVideoEncoding.resolutionScale.value,scalabilityMode:o.addVideoEncoding.scalabilityMode.value,action:'<button class="btn btn-primary remove">Delete</button>'}).draw()})),document.getElementById("addAudioTrack").addEventListener("click",(function(e){let t={source:o.addAudioTrack.source.value,channels:o.addAudioTrack.channels.value,encodings:[]};a(t)}))},getAudioStreams:function(){let e=[];return o.tables.audio.rows().every((function(t,o,a){let n=this.data();e.push({stream:n.stream,encodings:[],source:n.source})})),e},getVideoStreams:function(){let e=[];return o.tables.video.rows().every((function(t,o,a){let n=this.data();e.push({stream:n.stream,encodings:n.encodings,source:n.source,type:n.type})})),e},onTrack:function(e){t=e},cleanTables:function(){o.tables.video.rows().remove().draw(),o.tables.audio.rows().remove().draw(),o.tables.encodings.rows().remove().draw()},controls:o}},getMedia=async function(e){let t=!1;const o={};let a;return e.forEach((function(e){"mic"===e.source?(o.audio={},e.constraints&&(o.audio=e.constraints),o.audio.stereo=1!==e.channels,e.channels&&2===e.channels&&(o.audio.echoCancellation=!1,o.audio.googEchoCancellation=!1)):"camera"===e.source?(o.video={},e.constraints&&(o.video=e.constraints),o.video.width=e.width,o.video.height=e.height):"screen"===e.source&&(o.video={},e.constraints&&(o.video=e.constraints),o.video.width=e.width,o.video.height=e.height,t=!0)})),a=t?await navigator.mediaDevices.getDisplayMedia(o):await navigator.mediaDevices.getUserMedia(o),a};