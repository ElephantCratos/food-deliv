<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flashphoner Web Call Server</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="icon" href="img/favicon.png">
    <script src="js/jquery-3.7.1.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <style>
        .navbar-nav > li {
            padding-left: 20px;
            padding-right: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand navbar-light bg-light">
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="demo.html"><i class="fa fa-play-circle-o fa-lg" aria-hidden="true"></i> Demo</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="securityDrpdwn" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user-secret fa-lg"></i> Security</a>
                    <div class="dropdown-menu" aria-labelledby="securityDrpdwn">
                        <a class="dropdown-item" href="certificates.html"><i class="fa fa-certificate fa-lg"></i> Certificates</a>
                        <a class="dropdown-item" href="passwords.html"><i class="fa fa-key fa-lg"></i> Set password</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="license.html"><i class="fa fa-files-o fa-lg"></i> License</a>
                </li>

            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link"><span id="version"></span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="user" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user fa-lg"> </i><span id="username"> </span></a>
                    <div class="dropdown-menu" aria-labelledby="user">
                        <a class="dropdown-item" href="#" id="logout"><i class="fa fa-sign-out fa-lg"></i> Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="row justify-content-center">
            <h1 class="text-center font-weight-bold">Web Call Server 5 License</h1>
        </div>
        <div class="row justify-content-center">
            <p class="text-success" id="activated"></p>
        </div>
        <div class="row justify-content-center">
            <p id="number"></p>
        </div>
        <div class="row justify-content-center">
            <div class="col-2">
                <p id="type"> License</p>
            </div>
            <div class="col-2">
                <p id="expires">Expires </p>
            </div>
            <div class="col-2">
                <a id="deactivate" href="#" class="text-hide "><u>Deactivate</u></a>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#username").text($.cookie("wcs_user"));
            $("#version").text($.cookie("wcs_version"));
            if ($("#username").text() != "admin") {
                $("#deactivate").addClass('d-none');
            }
            $("#logout").click(function(){
                $.ajax({
                    type: "POST",
                    url: "/admin/api/logout",
                    success: function (data, status, xhr) {
                        document.location = "/admin/"
                    }
                })
            });
            $.ajax({
               type: "POST",
               url: "/admin/api/license/info",
               dataType: "json",
               contentType : "application/json",
               success: function(data, status, xhr) {
                   if (data.result.license.activated) {
                       $("#activated").text("The license is activated");
                       $("#number").text(data.result.license.number);
                       $("#type").prepend(data.result.license.type);
                       $("#expires").append(data.result.license.date);
                       $("#deactivate").removeClass("text-hide");
                   }
               }
            });
            $("#deactivate").click(function() {
               $.ajax({
                   type: "POST",
                   url: "/admin/api/license/deactivate",
                   success: function(data, status, xhr) {
                       if (data.result.message == "success") {
                           location.reload();
                       }
                   },
                   error: function (xhr, status, error) {
                   }
               })
            })
        });
    </script>
</body>
</html>